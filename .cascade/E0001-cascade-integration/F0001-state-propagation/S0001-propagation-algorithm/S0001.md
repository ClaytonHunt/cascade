---
id: S0001
type: Story
title: Propagation Algorithm Implementation
status: in-progress
priority: critical
complexity: complex
parent: F0001
created: 2025-01-06
updated: 2025-01-06
---

# Propagation Algorithm Implementation

## Description

Implement the core propagation algorithm that updates parent state.json files when a child state changes. The algorithm should be recursive, stopping at the project root.

## Acceptance Criteria

- [ ] Load child state.json and extract status/progress
- [ ] Look up parent ID from registry
- [ ] Update parent.children[childId] with new status/progress
- [ ] Recalculate parent progress metrics
- [ ] Write updated parent state.json atomically
- [ ] Recursively propagate to grandparent
- [ ] Handle edge cases: missing parent, no parent (root), malformed state

## Dependencies

- Depends on: StateManager, RegistryManager
- Blocks: File watcher integration

## Children

- T0001: Implement state loading logic
- T0002: Implement parent lookup
- T0003: Implement parent state update
- T0004: Add recursive propagation

## Acceptance Tests

```typescript
// Test: Single-level propagation (Story → Feature)
given: S0001 changes status to "completed"
when: propagation runs
then: F0001.children["S0001"] = { status: "completed", progress: 100 }
  and: F0001.progress.completed += 1
  and: F0001.progress.percentage updated

// Test: Multi-level propagation (Task → Story → Feature → Epic → Project)
given: T0001 completes
when: propagation runs
then: All ancestors updated in sequence

// Test: Stop at root
given: P0001 updated
when: propagation runs
then: No error, no infinite loop
```

## Technical Notes

Algorithm from CASCADE-INTEGRATION-SPEC.md lines 332-351:

```
function propagateStateChange(childPath) {
  1. Load changed child state.json
  2. Extract child ID and parse state
  3. Look up parent from registry using child ID
  4. If no parent, stop (reached root)
  5. Load parent state.json
  6. Update parent.children[childId] with:
     - status from child.status
     - progress from child.progress.percentage
  7. Recalculate parent progress
  8. Update parent.updated timestamp
  9. Write parent state.json
  10. Recursively call propagateStateChange(parentPath)
}
```
