---
id: T0003
type: Task
title: Implement parent state update
status: in-progress
priority: critical
complexity: medium
parent: S0001
created: 2025-01-06
updated: 2025-01-06
---

# Implement parent state update

## Description

Update parent's state.json to reflect child's new status and progress. Recalculate parent's progress metrics.

## Implementation

```typescript
function updateParentState(
  parentState: StateData,
  childId: string,
  childStatus: string,
  childProgress: number
): StateData {
  // Update parent.children[childId]
  parentState.children[childId] = {
    status: childStatus,
    progress: childProgress
  };

  // Recalculate parent progress
  const children = Object.values(parentState.children);
  const completed = children.filter(c => c.status === 'completed').length;
  const inProgress = children.filter(c => c.status === 'in-progress').length;
  const planned = children.filter(c => c.status === 'planned').length;
  const total = children.length;

  parentState.progress = {
    total_items: total,
    completed,
    in_progress: inProgress,
    planned,
    percentage: total > 0 ? Math.round((completed / total) * 100) : 0
  };

  parentState.updated = new Date().toISOString();

  return parentState;
}
```

## Acceptance Criteria

- [ ] Update parent.children[childId] with new status/progress
- [ ] Count children by status (completed, in-progress, planned, blocked)
- [ ] Calculate percentage: (completed / total) * 100
- [ ] Update timestamp
- [ ] Handle edge cases: no children, all blocked

## Notes

This is the core of the propagation logic - where progress metrics are calculated.
